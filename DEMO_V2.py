#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
时效性验证功能演示 v2.0
展示如何使用带时效性的密钥系统
"""

import os
from datetime import datetime, timedelta

def print_header(title):
    """打印标题"""
    print("\n" + "=" * 80)
    print(f"  {title}")
    print("=" * 80 + "\n")

def demo_time_validity():
    """演示时效性验证功能"""

    print_header("时效性验证功能演示 v2.0")

    print("本演示展示如何为不同用户生成带时效性的激活密钥\n")

    # 示例1: 试用版用户
    print("📌 场景1: 试用版用户")
    print("-" * 80)
    print("""
用户: 小张 (新用户，想试用软件)
需求: 3天试用期

操作步骤:
1. 运行: python tools/generate_keys_v2.py
2. 输入用户信息:
   - 用户ID: TRIAL_001
   - 用户名: 小张
   - 备注: 试用用户
   - 有效期: 选择"1天"或自定义"3天"

生成结果:
   激活密钥: a1b2c3d4e5f6...(60位)...1234
   有效期: 3 天
   过期时间: {}

用户体验:
   ✅ 首次使用: "首次激活成功！有效期 3 天"
   ✅ 第2天使用: "密钥有效，还剩 2 天"
   ✅ 第3天使用: "密钥有效，还剩 1 天" + 弹窗提醒续费
   ❌ 第4天使用: "密钥已过期" → 无法启动
    """.format((datetime.now() + timedelta(days=3)).strftime('%Y-%m-%d %H:%M:%S')))

    input("按回车继续...")

    # 示例2: 月卡用户
    print("\n📌 场景2: 月卡用户")
    print("-" * 80)
    print("""
用户: 李四 (购买月卡)
需求: 30天使用权限

操作步骤:
1. 运行: python tools/generate_keys_v2.py
2. 输入用户信息:
   - 用户ID: MONTHLY_001
   - 用户名: 李四
   - 备注: 月卡用户 - 2025年1月
   - 有效期: 选择"30天"

生成结果:
   激活密钥: b2c3d4e5f6g7...(60位)...c7f8
   有效期: 30 天
   过期时间: {}

用户体验:
   ✅ 第1-23天: 正常使用，显示剩余天数
   ⚠️ 第24-30天: 显示剩余天数 + 提醒续费
   ❌ 第31天后: 密钥过期，需要续费
    """.format((datetime.now() + timedelta(days=30)).strftime('%Y-%m-%d %H:%M:%S')))

    input("按回车继续...")

    # 示例3: 年卡用户
    print("\n📌 场景3: 年卡用户")
    print("-" * 80)
    print("""
用户: 王五 (购买年卡)
需求: 365天使用权限

操作步骤:
1. 运行: python tools/generate_keys_v2.py
2. 输入用户信息:
   - 用户ID: YEARLY_001
   - 用户名: 王五
   - 备注: 年卡用户 - 2025年度
   - 有效期: 选择"365天"

生成结果:
   激活密钥: c3d4e5f6g7h8...(60位)...9abc
   有效期: 365 天
   过期时间: {}

用户体验:
   ✅ 第1-358天: 正常使用，显示剩余天数
   ⚠️ 第359-365天: 显示剩余天数 + 提醒续费
   ❌ 第366天后: 密钥过期，需要续费
    """.format((datetime.now() + timedelta(days=365)).strftime('%Y-%m-%d %H:%M:%S')))

    input("按回车继续...")

    # 示例4: 永久用户
    print("\n📌 场景4: 永久授权用户")
    print("-" * 80)
    print("""
用户: 赵六 (购买永久版或VIP)
需求: 无限期使用权限

操作步骤:
1. 运行: python tools/generate_keys_v2.py
2. 输入用户信息:
   - 用户ID: PERMANENT_001
   - 用户名: 赵六
   - 备注: VIP用户 - 永久授权
   - 有效期: 选择"永久有效"

生成结果:
   激活密钥: d4e5f6g7h8i9...(60位)...0000  ← 注意后4位为"0000"
   有效期: 永久有效

用户体验:
   ✅ 任何时候: "永久有效" → 可以一直使用
   ✅ 无过期提醒
   ✅ 无需续费
    """)

    input("按回车继续...")

    # 示例5: 批量生成
    print("\n📌 场景5: 批量生成不同类型的密钥")
    print("-" * 80)
    print("""
场景: 同时为多个用户生成密钥

操作步骤:
1. 运行: python tools/generate_keys_v2.py
2. 选择选项 2 (批量生成)
3. 输入用户列表:

TRIAL_001,张三,3,3天试用
TRIAL_002,李四,3,3天试用
MONTHLY_001,王五,30,月卡用户
MONTHLY_002,赵六,30,月卡用户
YEARLY_001,孙七,365,年卡用户
PERMANENT_001,周八,0,永久用户
(输入空行结束)

结果:
   ✅ 成功生成 6 个密钥
   ✅ 每个密钥都有各自的有效期
   ✅ 可使用选项4导出到文件
    """)

    input("按回车继续...")

    # 示例6: 密钥续期
    print("\n📌 场景6: 用户续费延长有效期")
    print("-" * 80)
    print("""
场景: 月卡用户到期后续费

用户: 李四 (用户ID: MONTHLY_001)
当前状态: 30天月卡即将过期 (还剩2天)
需求: 续费1个月

操作步骤:
1. 运行: python tools/generate_keys_v2.py
2. 选择选项 5 (延长有效期)
3. 输入:
   - 用户ID: MONTHLY_001
   - 延长天数: 30

结果:
   [✓] 已为用户 MONTHLY_001 延长 30 天
   [✓] 新的过期时间: {}

用户体验:
   ✅ 无需更换密钥
   ✅ 继续使用原密钥
   ✅ 有效期自动延长30天
    """.format((datetime.now() + timedelta(days=32)).strftime('%Y-%m-%d %H:%M:%S')))

    input("按回车继续...")

    # 工作流程图
    print_header("完整工作流程")

    print("""
┌─────────────────────────────────────────────────────────────────────┐
│                          管理员端操作                                │
└─────────────────────────────────────────────────────────────────────┘

1️⃣  生成密钥
    python tools/generate_keys_v2.py
    ↓
    选择有效期: 1天/7天/30天/90天/365天/永久
    ↓
    生成64位密钥 (包含有效期信息)

2️⃣  分发密钥
    将密钥通过邮件/IM/网站发送给用户

3️⃣  查看状态
    定期查看所有密钥的有效期状态
    ↓
    发现即将过期的用户 → 提醒续费

4️⃣  用户续费
    收到续费后，使用"延长有效期"功能
    ↓
    或重新生成新密钥

┌─────────────────────────────────────────────────────────────────────┐
│                          用户端体验                                  │
└─────────────────────────────────────────────────────────────────────┘

1️⃣  首次使用
    运行 launcher_v2.exe
    ↓
    输入64位密钥
    ↓
    显示: "首次激活成功！有效期 30 天"
    ↓
    程序正常启动

2️⃣  日常使用
    运行 launcher_v2.exe
    ↓
    自动读取激活记录
    ↓
    显示: "密钥有效，还剩 25 天"
    ↓
    程序正常启动

3️⃣  有效期不足 (≤7天)
    运行 launcher_v2.exe
    ↓
    显示: "密钥有效，还剩 5 天"
    ↓
    弹窗: "⚠️ 您的密钥还剩 5 天有效期，请及时续期！"
    ↓
    程序正常启动

4️⃣  密钥过期
    运行 launcher_v2.exe
    ↓
    显示: "密钥已过期"
    ↓
    弹窗: "❌ 密钥已过期，请联系管理员续期"
    ↓
    程序拒绝启动

5️⃣  续费后
    收到续费确认和延期通知
    ↓
    继续使用原密钥即可 (无需重新输入)
    ↓
    有效期已自动延长
    """)

    input("按回车继续...")

    # 商业应用场景
    print_header("商业应用场景")

    scenarios = [
        {
            "title": "💡 SaaS订阅制软件",
            "description": """
场景: 云端软件订阅服务
定价:
  - 试用版: 免费 7天
  - 基础版: ¥49/月 (30天)
  - 专业版: ¥399/年 (365天)

实现:
  1. 用户注册后获得7天试用密钥
  2. 试用满意后购买月卡或年卡
  3. 系统自动生成对应时长的密钥
  4. 到期前7天邮件/短信提醒续费
  5. 续费后使用"延长有效期"功能
            """
        },
        {
            "title": "🎮 游戏月卡系统",
            "description": """
场景: 网络游戏付费系统
定价:
  - 周卡: ¥19/周 (7天)
  - 月卡: ¥49/月 (30天)
  - 季卡: ¥129/季 (90天)

实现:
  1. 玩家购买后立即获得密钥
  2. 首次登录激活，开始计时
  3. 卡内可以无限次登录
  4. 到期后需要续费或购买新卡
            """
        },
        {
            "title": "📚 在线教育课程",
            "description": """
场景: 在线课程访问权限
定价:
  - 单月: ¥99/月 (30天)
  - 季度: ¥249/季 (90天)
  - 年度: ¥799/年 (365天)

实现:
  1. 学员购买课程后获得密钥
  2. 在有效期内可以无限次学习
  3. 课程软件/客户端需要密钥启动
  4. 支持课程延期、续费
            """
        },
        {
            "title": "🏢 企业内部工具",
            "description": """
场景: 企业内部软件授权
定价:
  - 临时员工: 30天/90天
  - 正式员工: 365天
  - 核心员工: 永久授权

实现:
  1. 员工入职时分配对应期限密钥
  2. 密钥与员工工号绑定
  3. 离职后密钥自动过期
  4. 转正后延长有效期或升级为永久
            """
        }
    ]

    for scenario in scenarios:
        print(f"\n{scenario['title']}")
        print("-" * 80)
        print(scenario['description'])
        input("按回车查看下一个场景...")

    # 总结
    print_header("功能总结")

    print("""
✅ V2 版本新增功能:

🔐 时效性验证
   - 支持自定义有效期天数
   - 预设常用期限 (1天/7天/30天/90天/365天)
   - 支持永久有效密钥

⏰ 首次激活机制
   - 从用户首次使用开始计时
   - 自动记录激活时间
   - 防止提前激活浪费时间

📊 有效期管理
   - 实时显示剩余天数
   - 有效期不足7天自动提醒
   - 支持在线延长有效期

🛡️ 安全性保障
   - 密钥包含有效期指纹
   - 本地记录防篡改
   - AES-256加密保护

💼 商业应用
   - 试用版控制
   - 订阅制收费
   - 灵活的授权模式

📈 数据统计
   - 查看所有密钥状态
   - 过期/有效分类显示
   - 导出密钥清单

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🚀 立即开始使用:

1. 安装依赖
   cd tools
   pip install -r requirements.txt

2. 生成带时效性的密钥
   python generate_keys_v2.py

3. 编译V2启动器
   cd dist
   pyinstaller --onefile --windowed --name=launcher_v2 launcher_v2.py

4. 测试时效性验证
   - 生成一个1天的测试密钥
   - 运行launcher_v2.exe测试
   - 查看有效期显示和提醒功能

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📖 相关文档:
   - 时效性验证说明.md  ← 详细说明文档
   - README.md           ← 基础功能文档
   - 快速入门.md         ← 快速上手指南

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    """)

if __name__ == "__main__":
    try:
        demo_time_validity()
        print("\n演示完成！现在您可以开始使用时效性验证功能了。\n")
    except KeyboardInterrupt:
        print("\n\n演示已中断。\n")
